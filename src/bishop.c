#include "bishop.h"
#include "magic.h"

const magic_entry bishop_magic_table[64] = {
    {bishop_0, 0x40201008040200, 0x4008100c40902201, 58},
    {bishop_1, 0x402010080400, 0x8080800d04030, 59},
    {bishop_2, 0x4020100a00, 0x504010409000401, 59},
    {bishop_3, 0x40221400, 0x2060a1004030da08, 59},
    {bishop_4, 0x2442800, 0x45104008200098, 59},
    {bishop_5, 0x204085000, 0xc110080c800220, 59},
    {bishop_6, 0x20408102000, 0x40886110100000, 59},
    {bishop_7, 0x2040810204000, 0x4108920510221040, 58},
    {bishop_8, 0x20100804020000, 0x10401004089080, 59},
    {bishop_9, 0x40201008040000, 0x30a0040800840080, 59},
    {bishop_10, 0x4020100a0000, 0x801240c04014402, 59},
    {bishop_11, 0x4022140000, 0x440110502003800, 59},
    {bishop_12, 0x244280000, 0x400d011140000400, 59},
    {bishop_13, 0x20408500000, 0x4020904202006, 59},
    {bishop_14, 0x2040810200000, 0x850940904102600, 59},
    {bishop_15, 0x4081020400000, 0x5010a41046004, 59},
    {bishop_16, 0x10080402000200, 0x2004c02828080800, 59},
    {bishop_17, 0x20100804000400, 0x403112004040080, 59},
    {bishop_18, 0x4020100a000a00, 0x4804000200340500, 57},
    {bishop_19, 0x402214001400, 0x4000124048002, 57},
    {bishop_20, 0x24428002800, 0x11020820080010, 57},
    {bishop_21, 0x2040850005000, 0x4006000100aa0100, 57},
    {bishop_22, 0x4081020002000, 0xc010c0e09500208, 59},
    {bishop_23, 0x8102040004000, 0x6092040911421601, 59},
    {bishop_24, 0x8040200020400, 0x410408210020201, 59},
    {bishop_25, 0x10080400040800, 0x1042034410140800, 59},
    {bishop_26, 0x20100a000a1000, 0x200480010042040, 57},
    {bishop_27, 0x40221400142200, 0x11040c0008020908, 55},
    {bishop_28, 0x2442800284400, 0x1010000104000, 55},
    {bishop_29, 0x4085000500800, 0x8818008080c00, 57},
    {bishop_30, 0x8102000201000, 0x1018011000808800, 59},
    {bishop_31, 0x10204000402000, 0x6009110008208820, 59},
    {bishop_32, 0x4020002040800, 0x1082025082000, 59},
    {bishop_33, 0x8040004081000, 0x1002900400100489, 59},
    {bishop_34, 0x100a000a102000, 0x41080100080840, 57},
    {bishop_35, 0x22140014224000, 0x2140040100100900, 55},
    {bishop_36, 0x44280028440200, 0x120008400050410, 55},
    {bishop_37, 0x8500050080400, 0x1208100041008800, 57},
    {bishop_38, 0x10200020100800, 0x4008030508040080, 59},
    {bishop_39, 0x20400040201000, 0x214140c22008480, 59},
    {bishop_40, 0x2000204081000, 0x1012022041001, 59},
    {bishop_41, 0x4000408102000, 0x4090402009022, 59},
    {bishop_42, 0xa000a10204000, 0x9c6020602010c40, 57},
    {bishop_43, 0x14001422400000, 0x4208008283, 57},
    {bishop_44, 0x28002844020000, 0x24020120a802400, 57},
    {bishop_45, 0x50005008040200, 0x20200810002084c0, 57},
    {bishop_46, 0x20002010080400, 0x20080101000040, 59},
    {bishop_47, 0x40004020100800, 0x1002040242830212, 59},
    {bishop_48, 0x20408102000, 0x46080c14141940, 59},
    {bishop_49, 0x40810204000, 0x2018c04062000, 59},
    {bishop_50, 0xa1020400000, 0x250041304700, 59},
    {bishop_51, 0x142240000000, 0x2081000120880000, 59},
    {bishop_52, 0x284402000000, 0x1899409002020200, 59},
    {bishop_53, 0x500804020000, 0x80045002020044, 59},
    {bishop_54, 0x201008040200, 0x142100420808000, 59},
    {bishop_55, 0x402010080400, 0x1252080214005061, 59},
    {bishop_56, 0x2040810204000, 0x80440421080202, 58},
    {bishop_57, 0x4081020400000, 0x4000208041086000, 59},
    {bishop_58, 0xa102040000000, 0x800010842029004, 59},
    {bishop_59, 0x14224000000000, 0x800002101048805, 59},
    {bishop_60, 0x28440200000000, 0x18004008ae00, 59},
    {bishop_61, 0x50080402000000, 0x800000810100180, 59},
    {bishop_62, 0x20100804020000, 0x4020a21802080140, 59},
    {bishop_63, 0x40201008040200, 0x2062089200820200, 58},
};

bboard bishop_attacks(bboard rook, bboard occupancy) {
    int index = lsb(rook);       
    const magic_entry *m = &bishop_magic_table[index];
    return m->attack_table[(occupancy * m->magic) >> m->shift];
}
